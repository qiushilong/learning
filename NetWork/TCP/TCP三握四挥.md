# TCP 三次握手四次挥手

## TCP 报文字段（有关的）

- 源端口：源端口，浏览器所用端口号。
- 目的端口：目的端口。默认端口，http：80，https：443。

- 序号（Sequence Number, seq）：32 位，用来标识 TCP 源端向目的端发送的报文，作为后续报文的标识。
- 确认号（Acknowledgement Number, ack）：32 位，只有 ACK 标志位为 1 时，确定号才有效，确认号 = 序号 + 1。
- 标志位：共 6 个，各占 1 位。URG、ACK、PSH、RST、SYN、FIN。1 表示开启，0表示关闭。
  - URG：紧急指针有效。
  - ACK：确定序号有效。
  - PSH：接收方应该尽快将这个报文交给应用层。
  - RST：重置连接。
  - SYN：发起一个连接。
  - FIN：释放一个连接。



## 握手之前

网络层 IP 连接成功。



## 三次握手

所谓三次握手，是指建立一个 TCP 连接时，需要客户端和服务器总共发送 3 个包。

三次握手的目的是连接服务器指定端口，建立 TCP 连接，并同步连接双方的序列号和确定号，并交换 TCP 窗口大小信息。

三次握手确定了客户端和服务端都有收发能力。

流程（核心步骤）：

1. 客户端随机生成序号，然后设置报文：序号 = 随机序号，SYN = 1，将报文发送到服务器。
2. 服务器接收到报文，随机生成序号，设置确认号 = 收到报文序号 + 1，然后设置报文：序号 = 随机序号，确认号：收到报文序号 + 1，SYN = 1，ACK = 1，将报文发送到客户端。
3. 客户端接收到报文，设置序号 = 收到确认号，确认号 = 收到序号 + 1，然后设置报文：序号 = 收到确认号，确认号 = 收到序号 + 1，ACK = 1，将报文发送到服务端。
4. 完成握手。

![](.\img\三次握手流程.jpg)

## 握手后

建立 TCP 连接后，客户端就可以发送 HTTP 请求获取服务器数据了。



## 四次挥手

![](.\img\四次挥手.jpg)